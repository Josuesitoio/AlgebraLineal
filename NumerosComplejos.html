<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Números Complejos I - Fundamentos</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
    
/* =========================================
   ESTILOS CSS (Diseño Glassmorphism)
   ========================================= */

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px) scale(0.98); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes fadeInContent {
  from { opacity: 0; transform: translateY(15px); }
  to   { opacity: 1; transform: translateY(0); }
}

* { box-sizing: border-box; }
html, body { height: 100%; }
html { -webkit-text-size-adjust: 100%; }

body {
  margin: 0;
  font-family: 'Montserrat', system-ui, -apple-system, sans-serif;
  -webkit-font-smoothing: antialiased;
  color: #f5f5f7;
  background-color: #0d0c1b;
  padding: 50px 20px;
  display: flex;
  align-items: flex-start;
  justify-content: center;
  min-height: 100vh;
  overflow-y: auto;
  /* Fondo animado simulado con gradientes fijos */
  background-image:
    radial-gradient(circle 800px at 10% 20%, #9b5de5 0%, transparent 40%),
    radial-gradient(circle 700px at 90% 80%, #0a84ff 0%, transparent 40%),
    radial-gradient(circle 600px at 30% 70%, #ff1493 0%, transparent 40%),
    radial-gradient(circle 500px at 70% 30%, #ffff00 0%, transparent 40%),
    conic-gradient(from 180deg at 50% 50%, rgba(255,255,255,0.05) 0deg, transparent 90deg, transparent 180deg, rgba(255,255,255,0.05) 270deg, transparent 360deg);
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: 150% 150%;
  background-position: center center;
}

:root{
  --bg-base: #0d0c1b;
  --card: rgba(28,28,30,0.94);
  --text: #f5f5f7;
  --muted: #b6b6bb;
  --muted-strong: #9ea0a6;
  --border-color: rgba(255,255,255,0.12);
  --shadow-color: rgba(0,0,0,0.48);
  --accent1: #9b5de5;
  --accent2: #0a84ff;
  --code-bg: #151516;
  --code-text: #e7e7e8;
  --heading-line-height: 1.08;
  --body-line-height: 1.7;
}

html { font-size: clamp(15px, 1.2vw + 12px, 18px); }

.sheet {
  width: min(1400px, 96vw);
  background: var(--card);
  border-radius: 30px;
  padding: 40px;
  -webkit-backdrop-filter: blur(18px) saturate(170%);
  backdrop-filter: blur(18px) saturate(170%);
  box-shadow: 0 25px 50px -12px var(--shadow-color), inset 0 1px 1px rgba(255,255,255,0.04);
  position: relative;
  border: 1px solid var(--border-color);
  animation: fadeIn 0.9s cubic-bezier(.2,.8,.2,1) both;
  margin: 50px 0;
}

.header {
  text-align: center;
  margin-bottom: 36px;
  padding-bottom: 20px;
  border-bottom: 1px solid var(--border-color);
}
.title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.8rem, 2.8vw + 1rem, 3.2rem);
  line-height: var(--heading-line-height);
  color: var(--text);
  font-weight: 700;
  margin: 0;
}
.subtitle {
  font-style: italic;
  color: var(--muted);
  font-size: clamp(0.95rem, 0.8vw + 0.8rem, 1.15rem);
  max-width: 700px;
  margin: 12px auto 0;
}

.page-layout {
  display: grid;
  grid-template-columns: minmax(0, 260px) 1fr;
  gap: 45px;
  align-items: start;
}

/* Sidebar */
.sidebar {
  position: sticky;
  top: 40px;
  align-self: start;
  z-index: 3;
  max-width: 260px;
}
.sidebar-nav { list-style: none; padding: 0; margin: 0; }
.sidebar-nav a {
  display: block;
  padding: 10px 14px;
  text-decoration: none;
  color: var(--muted);
  font-weight: 600;
  font-size: 0.95rem;
  border-radius: 10px;
  transition: all 0.18s ease;
  border: 1px solid transparent;
  cursor: pointer;
}
.sidebar-nav a:hover {
  background-color: rgba(255,255,255,0.04);
  color: var(--text);
}
.sidebar-nav a.active {
  color: var(--accent1);
  background-color: rgba(155,93,229,0.12);
  border: 1px solid rgba(155,93,229,0.28);
}

/* Contenido */
.content-section { display: none; }
.content-section.active {
  display: block;
  animation: fadeInContent .6s cubic-bezier(.2,.8,.2,1) both;
}
.content-section h2 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.4rem, 1.8vw + 0.8rem, 2.2rem);
  color: var(--accent1);
  margin-top: 0;
  margin-bottom: 18px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-color);
}
.content-section h3 {
  font-size: 1.18rem;
  color: var(--text);
  font-weight: 700;
  margin-top: 28px;
  margin-bottom: 12px;
}
.content-section p, .content-section ul {
  font-size: 1.05rem;
  color: var(--text);
  line-height: var(--body-line-height);
  max-width: 80ch;
  margin: 0 0 16px 0;
}
.content-section ul { padding-left: 28px; }
.content-section li { margin-bottom: 10px; }

/* Code Blocks */
.code-block-wrapper { position: relative; margin: 25px 0; }
pre {
  background-color: var(--code-bg);
  border-radius: 12px;
  padding: 18px;
  overflow-x: auto;
  border: 1px solid var(--border-color);
  font-family: 'Fira Code', monospace;
  font-size: 0.95rem;
  line-height: 1.5;
}
code {
  font-family: 'Fira Code', monospace;
  color: var(--code-text);
}
.ascii-art {
  background-color: var(--code-bg);
  border-radius: 8px;
  padding: 12px;
  font-family: 'Fira Code', monospace;
  font-size: 0.9rem;
  white-space: pre-wrap;
  margin: 15px 0;
  border: 1px solid var(--border-color);
}
.copy-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.03);
  color: var(--muted);
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.82rem;
  font-weight: 700;
}
.copy-btn:hover { background-color: var(--accent1); color: white; }

/* Sintaxis de código */
.code-keyword { color: #ff6b9f; font-weight: 600; }
.code-class   { color: #9be564; }
.code-string  { color: #e6db74; }
.code-comment { color: #7b7b68; font-style: italic; }

/* Tablas */
.table-wrapper {
  margin-top: 20px;
  overflow: auto;
  border-radius: 12px;
  border: 1px solid var(--border-color);
}
table { width: 100%; border-collapse: collapse; font-size: 0.95rem; min-width: 360px; }
th, td { padding: 12px 14px; text-align: left; border-bottom: 1px solid var(--border-color); }
thead { background-color: rgba(255,255,255,0.03); color: var(--muted-strong); }
tbody tr:nth-child(even) { background-color: rgba(255,255,255,0.02); }

/* Info Box */
.info-box {
  background-color: rgba(155,93,229,0.08);
  border-left: 4px solid var(--accent1);
  padding: 18px 22px;
  border-radius: 12px;
  margin: 22px 0;
}
.info-box h3 { margin: 0 0 8px 0; color: var(--accent1); font-size: 1.05rem; }

/* Quiz Styles */
#quiz-container { display:flex; flex-direction:column; gap:20px; margin-top: 26px; }
.quiz-card {
  background-color: rgba(255,255,255,0.02);
  border: 1px solid var(--border-color);
  border-radius: 14px;
  padding: 18px;
}
.quiz-question { font-size: 1.05rem; font-weight: 700; margin: 0 0 12px; color: var(--text); }
.quiz-options { display:flex; flex-direction:column; gap:10px; }
.quiz-option {
  background-color: rgba(255,255,255,0.03);
  padding: 12px;
  border-radius: 10px;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.15s ease;
}
.quiz-option:hover { background-color: rgba(255,255,255,0.06); }
.quiz-option.correct { background-color: rgba(40,167,69,0.12); border-color: rgba(40,167,69,0.9); color: #c7f0c9; font-weight: 700; }
.quiz-option.incorrect { background-color: rgba(220,53,69,0.12); border-color: rgba(220,53,69,0.9); color: #f7c6c9; font-weight: 700; }
.quiz-options.disabled .quiz-option { pointer-events: none; opacity: 0.6; }
.quiz-feedback { margin-top: 12px; font-weight: 600; min-height: 20px; }
.quiz-feedback.correct { color: #28a745; }
.quiz-feedback.incorrect { color: #dc3545; }

#quiz-results-container {
  margin-top: 20px; padding: 18px;
  background-color: rgba(0,0,0,0.06); border-radius: 12px; text-align: center; display: none;
}
#quiz-score { font-size: 1.6rem; font-weight: 800; color: var(--accent1); margin: 0 0 12px; }
#quiz-reset-btn {
  background-image: linear-gradient(45deg, var(--accent1), var(--accent2));
  color: white; border: none; padding: 10px 20px; font-size: 1rem; font-weight: 700; border-radius: 999px; cursor: pointer;
}

@media (max-width: 1024px) {
  .page-layout { grid-template-columns: 1fr; gap: 28px; }
  .sidebar { position: static; max-width: 100%; border-bottom: 1px solid var(--border-color); padding-bottom: 12px; }
}
/* --- ESTILOS EXTRA PARA LA SECCIÓN 1.1 --- */

/* Contenedor de la fórmula matemática grande */
.math-display {
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    padding: 30px;
    text-align: center;
    margin: 30px 0;
    font-family: 'Playfair Display', serif;
    font-size: clamp(2rem, 4vw, 3.5rem);
    color: var(--text);
    box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
}
.math-var { color: var(--accent1); font-style: italic; }
.math-term { color: var(--accent2); }
.math-unit { color: #ff6b9f; font-weight: bold; }

/* Grid de tarjetas de concepto */
.concept-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.concept-card {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 20px;
    position: relative;
    transition: transform 0.2s ease, background 0.2s ease;
}

.concept-card:hover {
    transform: translateY(-5px);
    background: rgba(255, 255, 255, 0.06);
    border-color: var(--accent1);
}

.concept-card.highlight {
    background: rgba(155, 93, 229, 0.1); /* Tinte púrpura suave */
    border-color: rgba(155, 93, 229, 0.3);
}

.card-icon {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--muted);
    opacity: 0.3;
    position: absolute;
    top: 15px;
    right: 20px;
}

.concept-card h4 {
    color: var(--accent2);
    margin: 0 0 10px 0;
    font-size: 1.1rem;
}

.concept-card p {
    font-size: 0.9rem;
    line-height: 1.5;
    margin: 0;
    color: var(--muted);
}

/* Ciclo de potencias */
.cycle-container {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
    align-items: center;
    margin: 25px 0;
    padding: 20px;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 12px;
}

.cycle-step {
    background: var(--code-bg);
    border: 1px solid var(--border-color);
    padding: 10px 20px;
    border-radius: 8px;
    font-family: 'Fira Code', monospace;
    font-weight: bold;
    color: var(--accent1);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.cycle-note {
    font-size: 0.9rem;
    color: var(--muted);
    margin-left: 10px;
    font-style: italic;
}

/* --- ESTILOS EXTRA PARA LA SECCIÓN 1.2 (Plano Complejo) --- */

/* Tarjetas de Ejes (Layout Flexible) */
.axis-explanation {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 30px;
}

.axis-card {
    display: flex;
    align-items: center;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border-color);
    padding: 15px;
    border-radius: 12px;
}

.axis-icon {
    font-family: 'Fira Code', monospace;
    font-weight: bold;
    font-size: 1.2rem;
    padding: 10px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-right: 15px;
    color: var(--accent1);
}

.axis-card h4 { margin: 0 0 5px 0; font-size: 1rem; color: var(--text); }
.axis-card p { margin: 0; font-size: 0.85rem; color: var(--muted); }

/* --- GRÁFICO CSS --- */
.graph-container {
    position: relative;
    width: 100%;
    height: 320px;
    background-color: #080810; /* Fondo más oscuro para contraste */
    border: 1px solid var(--border-color);
    border-radius: 16px;
    overflow: hidden;
    margin: 20px 0;
    box-shadow: inset 0 0 30px rgba(0,0,0,0.5);
}

/* Rejilla (Grid Pattern) */
.graph-grid {
    width: 100%;
    height: 100%;
    /* Truco CSS para hacer papel milimétrico */
    background-image: 
        linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 40px 40px; /* Tamaño de los cuadros */
    background-position: center;
}

/* Ejes Centrales */
.axis-line {
    position: absolute;
    background-color: var(--muted-strong);
}
.x-axis {
    width: 100%; height: 2px;
    top: 50%; left: 0;
    box-shadow: 0 0 10px rgba(255,255,255,0.2);
}
.y-axis {
    width: 2px; height: 100%;
    left: 50%; top: 0;
    box-shadow: 0 0 10px rgba(255,255,255,0.2);
}

/* Etiquetas de Ejes Principales */
.graph-label {
    position: absolute;
    font-family: 'Playfair Display', serif;
    font-style: italic;
    color: var(--muted);
    font-size: 1.1rem;
}
.label-im { top: 10px; left: 51%; }
.label-re { right: 15px; top: 52%; }

/* --- EL PUNTO Z (Posicionamiento) --- */
.graph-point-wrapper {
    position: absolute;
    width: 0; height: 0;
    /* La posición se define inline en el HTML (top/left) */
}

.point-dot {
    width: 12px; height: 12px;
    background-color: var(--accent2); /* Azul brillante */
    border-radius: 50%;
    transform: translate(-50%, 50%); /* Centrar en la coordenada */
    box-shadow: 0 0 15px var(--accent2);
    position: relative;
    z-index: 2;
}

.point-label {
    position: absolute;
    color: var(--accent2);
    font-weight: bold;
    font-family: 'Fira Code', monospace;
    white-space: nowrap;
    top: -25px;
    left: 10px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
}

/* Líneas punteadas de proyección */
.projection-line {
    position: absolute;
    background: transparent;
    border: 1px dashed rgba(255,255,255,0.3);
}

/* Línea hacia abajo (al eje X) */
.to-x {
    border-left: none; border-top: none; border-bottom: none;
    border-right: 1px dashed rgba(255,255,255,0.3);
    /* Calculado para llegar al eje central (50%) desde el 70% de altura */
    height: 1000px; /* Truco: muy larga pero oculta por overflow del container si quisieramos, 
                       pero aqui usaremos top relativo al container */
    /* Mejor enfoque local: */
    top: 6px; 
    left: 0;
    height: 60px; /* Ajuste manual visual para la demo (del 70% al 50% son 20% de 320px = 64px) */
    width: 0;
}

/* Línea hacia izquierda (al eje Y) */
.to-y {
    border-top: none; border-right: none; border-left: none;
    border-bottom: 1px dashed rgba(255,255,255,0.3);
    right: 0;
    top: 6px;
    width: 60px; /* Ajuste visual para demo */
    height: 0;
}

/* Coordenadas a y b */
.coord-label {
    position: absolute;
    color: var(--muted);
    font-size: 0.8rem;
    font-family: 'Fira Code', monospace;
}
.coord-a { top: 70px; left: -5px; } /* En el eje X */
.coord-b { left: -75px; top: 0px; } /* En el eje Y */

@media (max-width: 768px) {
    .axis-explanation { grid-template-columns: 1fr; }
}

/* --- ESTILOS EXTRA PARA LA SECCIÓN 1.3 (Módulo/Arg) --- */

.properties-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.prop-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    transition: transform 0.2s;
}

.prop-card:hover {
    background: rgba(255, 255, 255, 0.04);
    transform: translateY(-3px);
    border-color: rgba(255, 255, 255, 0.2);
}

.prop-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.prop-icon {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, var(--accent2), var(--accent1));
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-family: 'Fira Code', monospace;
    margin-right: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.prop-card h3 {
    margin: 0;
    font-size: 1.2rem;
    color: var(--text);
}

/* Fórmulas matemáticas pequeñas dentro de tarjetas */
.math-formula-small {
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
    font-family: 'Times New Roman', serif; /* Estilo Math */
    font-style: italic;
    font-size: 1.4rem;
    margin-bottom: 15px;
    color: var(--accent2);
    border: 1px dashed rgba(255,255,255,0.1);
}

/* Visualización del Triángulo de Pitágoras con CSS */
.pythagoras-visual {
    position: relative;
    height: 100px;
    margin-top: auto; /* Empuja al fondo de la card */
    padding-top: 15px;
    display: flex;
    justify-content: center;
}

.py-triangle {
    width: 0;
    height: 0;
    border-bottom: 60px solid rgba(255, 255, 255, 0.1); /* Altura (b) */
    border-right: 80px solid transparent; /* Base (a) */
    position: relative;
}
/* La hipotenusa es el borde diagonal implícito */
.py-triangle::after {
    content: '';
    position: absolute;
    top: 60px; left: 0;
    width: 100px; /* Longitud visual aprox */
    height: 2px;
    background: var(--accent1);
    transform: rotate(-37deg); /* Ajuste manual para coincidir con la diagonal */
    transform-origin: 0 0;
}

.py-label {
    position: absolute;
    font-family: 'Fira Code', monospace;
    font-size: 0.8rem;
    color: var(--muted);
}
.py-a { bottom: 0; margin-left: -20px; } /* Base */
.py-b { left: 50%; margin-left: -55px; top: 50px;} /* Altura */
.py-c { top: 30px; left: 50%; color: var(--accent1); font-weight: bold; } /* Hipotenusa */

/* Caja de advertencia para atan2 */
.warning-box {
    background: rgba(255, 193, 7, 0.1);
    border-left: 3px solid #ffc107;
    padding: 12px;
    border-radius: 6px;
    margin-top: 15px;
    font-size: 0.9rem;
}
.warning-box strong { color: #ffc107; display: block; margin-bottom: 5px; }
.warning-box p { margin: 0; color: #ddd; }

/* --- ESTILOS EXTRA PARA LA SECCIÓN 1.4 (Representación) --- */

/* Estilos Específicos de la Tabla Glass */
.glass-table-container {
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border: none;
    background: rgba(0,0,0,0.2);
}

.glass-table {
    width: 100%;
    border-collapse: separate; 
    border-spacing: 0;
}

.glass-table th {
    background: rgba(255,255,255,0.05);
    border-bottom: 2px solid var(--accent1);
    color: var(--accent1);
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 1px;
}

.glass-table td {
    border-bottom: 1px solid rgba(255,255,255,0.05);
    transition: background 0.2s;
}

.glass-table tr:last-child td { border-bottom: none; }

.glass-table tr:hover td {
    background: rgba(255,255,255,0.03);
}

/* Celdas matemáticas en la tabla */
.math-cell {
    font-family: 'Times New Roman', serif;
    font-style: italic;
    font-size: 1.1rem;
    color: var(--accent2);
}

/* Badges para los nombres */
[class^="badge-"] {
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
    font-family: 'Montserrat', sans-serif;
}
.badge-bin { background: rgba(255, 99, 132, 0.15); color: #ff6384; }
.badge-pol { background: rgba(54, 162, 235, 0.15); color: #36a2eb; }
.badge-trig { background: rgba(255, 206, 86, 0.15); color: #ffce56; }
.badge-exp { background: rgba(75, 192, 192, 0.15); color: #4bc0c0; }

/* --- EULER HERO DISPLAY --- */
.euler-display {
    background: radial-gradient(circle at center, rgba(155, 93, 229, 0.15) 0%, rgba(0,0,0,0) 70%);
    border: 1px solid rgba(155, 93, 229, 0.3);
    border-radius: 16px;
    padding: 30px;
    text-align: center;
    margin: 30px 0;
    position: relative;
    overflow: hidden;
}

/* Efecto de brillo animado */
.euler-display::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: conic-gradient(transparent, rgba(255,255,255,0.05), transparent 30%);
    animation: rotate 10s linear infinite;
}
@keyframes rotate { 100% { transform: rotate(360deg); } }

.euler-formula {
    position: relative;
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.8rem, 3vw, 2.5rem);
    color: var(--text);
    margin-bottom: 10px;
    text-shadow: 0 0 20px rgba(155, 93, 229, 0.6);
}

.euler-desc {
    position: relative;
    color: var(--muted);
    font-size: 0.9rem;
    font-style: italic;
}

/* --- CONVERSION GRID --- */
.conversion-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.conversion-card {
    background: var(--code-bg);
    border: 1px solid var(--border-color);
    padding: 20px;
    border-radius: 12px;
}

.conversion-card h4 {
    margin: 0 0 10px 0;
    color: var(--accent2);
    display: flex;
    align-items: center;
    gap: 10px;
}

.arrow { color: var(--muted); font-weight: normal; }

.conv-formulas {
    margin-top: 15px;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
    padding: 10px;
}

.conv-row {
    font-family: 'Times New Roman', serif;
    font-style: italic;
    font-size: 1.1rem;
    color: var(--text);
    text-align: center;
    padding: 5px 0;
    border-bottom: 1px dashed rgba(255,255,255,0.1);
}
.conv-row:last-child { border-bottom: none; }

/* --- ESTILOS MEJORADOS CALCULADORA --- */
.calculator-container {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--border-color);
    border-radius: 20px;
    padding: 30px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    box-shadow: inset 0 0 40px rgba(0,0,0,0.3);
}

.complex-input-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

.input-label {
    font-family: 'Fira Code', monospace;
    color: var(--accent2);
    margin-bottom: 8px;
    font-size: 1rem;
}

.input-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(0,0,0,0.3);
    padding: 10px 20px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
}

.input-wrapper input {
    background: transparent;
    border: none;
    border-bottom: 2px solid var(--muted);
    color: var(--text);
    font-size: 1.2rem;
    width: 70px;
    text-align: center;
    font-family: 'Fira Code', monospace;
}
.input-wrapper input:focus { outline: none; border-color: var(--accent1); }

/* Botones Mini para Unarios */
.mini-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}
.mini-btn {
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--border-color);
    color: var(--muted);
    padding: 5px 10px;
    border-radius: 6px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
}
.mini-btn:hover { background: var(--accent2); color: white; border-color: var(--accent2); }

/* Botones Operaciones */
.calc-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    padding: 10px 0;
    border-bottom: 1px dashed rgba(255,255,255,0.1);
    width: 100%;
}

.calc-btn {
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.2s, box-shadow 0.2s;
}
.op-btn {
    background: linear-gradient(135deg, var(--accent1), #7b2cbf);
    color: white;
}
.op-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(155, 93, 229, 0.4); }

/* Sección Potencia */
.divider-line { width: 100%; height: 1px; background: rgba(255,255,255,0.1); margin: 5px 0; }

.power-wrapper {
    display: flex;
    align-items: center;
    gap: 15px;
    background: rgba(155, 93, 229, 0.1);
    padding: 10px 20px;
    border-radius: 12px;
    border: 1px solid rgba(155, 93, 229, 0.3);
}
.power-wrapper input {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border-color);
    color: white;
    width: 50px;
    padding: 5px;
    border-radius: 4px;
    text-align: center;
}
.power-btn {
    background: var(--accent2);
    color: white;
    padding: 8px 16px;
    font-size: 0.9rem;
}

/* Resultados */
.result-box {
    margin-top: 30px;
    background: rgba(0, 0, 0, 0.25);
    border: 1px solid var(--accent2);
    border-radius: 16px;
    padding: 25px;
}

.math-steps { font-size: 1.1rem; color: var(--muted-strong); margin-bottom: 25px; overflow-x: auto;}
.math-steps mjx-container { margin: 12px 0 !important; text-align: left !important; }

.results-summary {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    border-top: 1px solid rgba(255,255,255,0.1);
    padding-top: 20px;
}
.res-card {
    background: rgba(255,255,255,0.05);
    padding: 10px;
    border-radius: 8px;
    text-align: center;
}
.res-label { display: block; font-size: 0.8rem; color: var(--muted); text-transform: uppercase; margin-bottom: 5px; }
.res-val { font-family: 'Fira Code', monospace; color: var(--accent2); font-weight: bold; font-size: 1.1rem; }

@media (max-width: 600px) {
    .results-summary { grid-template-columns: 1fr; }
}
/* --- NUEVOS ESTILOS PARA GRÁFICO --- */

/* Indicadores de color para saber cual es cual en el gráfico */
.dot-indicator {
    display: inline-block;
    width: 10px; height: 10px;
    border-radius: 50%;
    margin-left: 5px;
    box-shadow: 0 0 5px currentColor;
}

/* Layout de Resultados (Grid de 2 columnas) */
.results-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.graph-column {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.canvas-wrapper {
    background: #080810;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 10px;
    box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
    margin-top: 10px;
}

canvas {
    background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
    border-radius: 8px;
    cursor: crosshair;
}

.graph-note {
    font-size: 0.8rem;
    color: var(--muted);
    margin-top: 10px;
    font-style: italic;
}

/* Responsivo para celulares: poner gráfico abajo */
@media (max-width: 900px) {
    .results-layout { grid-template-columns: 1fr; }
}
    </style>
</head>
<body>

    <div class="sheet">
        <header class="header">
            <h1 class="title">Números Complejos I: Fundamentos</h1>
            <p class="subtitle">Una extensión esencial de los números reales para la ingeniería y la física moderna.</p>
        </header>
        
        <div class="page-layout">
            <aside class="sidebar">
                <nav>
                    <ul class="sidebar-nav">
                        <li><a href="#s1-1">1. Definición y Origen</a></li>
                        <li><a href="#s1-2">2. El Plano Complejo</a></li>
                        <li><a href="#s1-3">3. Módulo y Argumento</a></li>
                        <li><a href="#s1-4">4. Formas de Representación</a></li>
                        <li><a href="#s1-5">5. Quiz de Conocimiento</a></li>
                    </ul>
                </nav>
            </aside>

         <section id="s1-1" class="content-section">
    <h2>1. Definición y Unidad Imaginaria</h2>
    <p>Los números complejos (\(\mathbb{C}\)) son una extensión de los números reales (\(\mathbb{R}\)). Surgen históricamente de la necesidad de resolver ecuaciones polinómicas sin solución real, como \(x^2 + 1 = 0\). Hoy en día, son la base matemática de la mecánica cuántica, el procesamiento de señales y el análisis de circuitos AC.</p>
    
    <div class="math-display">
        $$ z = a + bi $$
    </div>

    <div class="concept-grid">
        <div class="concept-card">
            <div class="card-icon">Re</div>
            <h4>Parte Real (a)</h4>
            <p>Es cualquier número real (\(a \in \mathbb{R}\)). Si \(b=0\), el número complejo es simplemente un número real.</p>
        </div>
        <div class="concept-card">
            <div class="card-icon">Im</div>
            <h4>Parte Imaginaria (b)</h4>
            <p>Es el coeficiente real que acompaña a la unidad imaginaria. Si \(a=0\) y \(b \neq 0\), se llama <strong>Imaginario Puro</strong>.</p>
        </div>
        <div class="concept-card highlight">
            <div class="card-icon">i</div>
            <h4>Unidad Imaginaria</h4>
            <p>Definida tal que <strong>\(i^2 = -1\)</strong>. Es el elemento que permite la existencia de raíces negativas.</p>
        </div>
    </div>

    <h3>El Ciclo de Potencias de i</h3>
    <p>Una propiedad fascinante de la unidad imaginaria es que sus potencias se repiten en un ciclo de cuatro pasos.</p>
    
    <div class="cycle-container">
        <div class="cycle-step">\(i^0 = 1\)</div>
        <div class="cycle-step">\(i^1 = i\)</div>
        <div class="cycle-step">\(i^2 = -1\)</div>
        <div class="cycle-step">\(i^3 = -i\)</div>
        <div class="cycle-note">... y el ciclo se repite (\(i^4 = 1\))</div>
    </div>

    <div class="info-box">
        <h3>Nota de Ingeniería</h3>
        <p>En ingeniería eléctrica y electrónica, la letra <strong>i</strong> ya se utiliza para representar la <em>intensidad de corriente</em>. Para evitar ambigüedades, se utiliza universalmente la letra <strong>j</strong> para la unidad imaginaria (\(j^2 = -1\)).</p>
    </div>

    <div class="code-block-wrapper">
        <button class="copy-btn">Copiar</button>
        <pre><code class="language-python"><span class="code-comment"># Python utiliza 'j' por defecto para números complejos</span>
z = 3 + 4j

print(f"Complejo: {z}")
print(f"Tipo de dato: {type(z)}")       <span class="code-comment"># <class 'complex'></span>
print(f"Parte Real: {z.real}")          <span class="code-comment"># 3.0</span>
print(f"Parte Imaginaria: {z.imag}")    <span class="code-comment"># 4.0</span>

<span class="code-comment"># Demostración del ciclo de potencias</span>
potencia = 1j ** 2
print(f"j al cuadrado es: {potencia}")  <span class="code-comment"># (-1+0j)</span></code></pre>
    </div>
</section>

<section id="s1-2" class="content-section">
    <h2>2. El Plano Complejo (Diagrama de Argand)</h2>
    <p>A diferencia de los números reales que ocupan una línea recta (1D), los números complejos habitan en un espacio bidimensional. Para visualizarlos, utilizamos un sistema de coordenadas cartesianas modificado conocido como <strong>Plano Complejo</strong>.</p>
    
    <div class="axis-explanation">
        <div class="axis-card horizontal">
            <div class="axis-icon">Re</div>
            <div class="axis-content">
                <h4>Eje Real (X)</h4>
                <p>El eje horizontal. Aquí se ubica la componente <strong>a</strong> del número \(z = a + bi\).</p>
            </div>
        </div>
        <div class="axis-card vertical">
            <div class="axis-icon">Im</div>
            <div class="axis-content">
                <h4>Eje Imaginario (Y)</h4>
                <p>El eje vertical. Aquí se ubica la componente <strong>b</strong> (la que acompaña a la \(i\)).</p>
            </div>
        </div>
    </div>

    <div class="graph-container">
        <div class="graph-grid"></div>
        <div class="axis-line x-axis"></div>
        <div class="axis-line y-axis"></div>
        
        <span class="graph-label label-im">Im</span>
        <span class="graph-label label-re">Re</span>

        <div class="graph-point-wrapper" style="bottom: 70%; left: 70%;">
            <div class="point-dot"></div>
            <div class="point-label">\(z = a + bi\)</div>
            <div class="projection-line to-x"></div>
            <div class="projection-line to-y"></div>
            <span class="coord-label coord-a">a</span>
            <span class="coord-label coord-b">b</span>
        </div>
    </div>

    <div class="info-box">
        <h3>Analogía Vectorial</h3>
        <p>Geométricamente, un número complejo se comporta exactamente igual que un <strong>vector en 2D</strong> que parte del origen \((0,0)\) hacia el punto \((a,b)\). Esto permite sumar complejos usando la "regla del paralelogramo", igual que en física.</p>
    </div>
</section>

<section id="s1-3" class="content-section">
    <h2>3. Módulo y Argumento (Coordenadas Polares)</h2>
    <p>Para pasar de la forma rectangular (\(a+bi\)) a la polar (\(r\angle\theta\)), necesitamos calcular la longitud del vector y su ángulo de inclinación. Estas dos magnitudes definen unívocamente al número complejo.</p>

    <div class="properties-container">
        <div class="prop-card">
            <div class="prop-header">
                <div class="prop-icon">|z|</div>
                <h3>El Módulo (r)</h3>
            </div>
            <div class="math-formula-small">
                $$ |z| = \sqrt{a^2 + b^2} $$
            </div>
            <p>Es la <strong>distancia</strong> desde el origen \((0,0)\) hasta el punto \(z\). Geométricamente, corresponde a la hipotenusa del triángulo formado por las componentes \(a\) y \(b\).</p>
            
            <div class="pythagoras-visual">
                <div class="py-triangle"></div>
                <span class="py-label py-c">|z|</span>
                <span class="py-label py-a">a</span>
                <span class="py-label py-b">b</span>
            </div>
        </div>

        <div class="prop-card">
            <div class="prop-header">
                <div class="prop-icon">θ</div>
                <h3>El Argumento (\(\theta\))</h3>
            </div>
            <div class="math-formula-small">
                $$ \theta = \arctan\left(\frac{b}{a}\right) $$
            </div>
            <p>Es el <strong>ángulo</strong> que forma el vector con el eje real positivo. Se mide en radianes (\(-\pi < \theta \le \pi\)).</p>
            
            <div class="warning-box">
                <strong>⚠️ Cuidado con el Cuadrante:</strong>
                <p>La fórmula básica de tangente inversa falla si \(a\) es negativo. En programación, SIEMPRE usa la función especial <code>atan2(b, a)</code> para obtener el ángulo correcto en los 360°.</p>
            </div>
        </div>
    </div>

    <div class="code-block-wrapper">
        <button class="copy-btn">Copiar</button>
        <pre><code class="language-python"><span class="code-keyword">import</span> cmath
<span class="code-keyword">import</span> math

z = -3 + 4j  <span class="code-comment"># Nota: Parte real negativa (2do Cuadrante)</span>

<span class="code-comment"># 1. CÁLCULO DEL MÓDULO (|z|)</span>
modulo = abs(z)
<span class="code-comment"># Manualmente: math.sqrt((-3)**2 + 4**2) = 5.0</span>

<span class="code-comment"># 2. CÁLCULO DEL ARGUMENTO (Fase)</span>
<span class="code-comment"># Forma correcta (maneja cuadrantes automáticamente):</span>
fase = cmath.phase(z) 
<span class="code-comment"># O usando math con componentes separadas:</span>
fase_manual = math.atan2(z.imag, z.real)

print(f"Número: {z}")
print(f"Módulo: {modulo}")           <span class="code-comment"># 5.0</span>
print(f"Fase (rad): {fase:.4f}")    <span class="code-comment"># 2.2143 (aprox 126.8°)</span></code></pre>
    </div>
</section>

<section id="s1-4" class="content-section">
    <h2>4. Formas de Representación</h2>
    <p>La versatilidad de los números complejos radica en que podemos escribirlos de distintas formas según la operación matemática que necesitemos realizar (sumar es fácil en binómica, pero multiplicar es fácil en polar).</p>

    <div class="table-wrapper glass-table-container">
        <table class="glass-table">
            <thead>
                <tr>
                    <th>Forma</th>
                    <th>Expresión Matemática</th>
                    <th>Cuándo usarla</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><span class="badge-bin">Binómica</span></td>
                    <td class="math-cell">$$ z = a + bi $$</td>
                    <td>Sumas, restas y álgebra básica.</td>
                </tr>
                <tr>
                    <td><span class="badge-pol">Polar</span></td>
                    <td class="math-cell">$$ z = r\angle\theta $$</td>
                    <td>Electrónica, fasores, visualización rápida.</td>
                </tr>
                <tr>
                    <td><span class="badge-trig">Trigonométrica</span></td>
                    <td class="math-cell">$$ z = r(\cos\theta + i\sin\theta) $$</td>
                    <td>Paso intermedio para conversiones.</td>
                </tr>
                <tr>
                    <td><span class="badge-exp">Exponencial</span></td>
                    <td class="math-cell">$$ z = r \cdot e^{i\theta} $$</td>
                    <td>Multiplicación, división, potencias y raíces.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h3>La Fórmula de Euler</h3>
    <p>Esta es considerada por muchos la "ecuación más bella de las matemáticas" porque conecta la geometría (trigonometría) con el álgebra (exponenciales).</p>
    
    <div class="euler-display">
        <div class="euler-formula">
            $$ e^{i\theta} = \cos(\theta) + i\sin(\theta) $$
        </div>
        <div class="euler-desc">
            Permite tratar la rotación en el plano complejo como una simple exponenciación.
        </div>
    </div>

    <h3>Guía Rápida de Conversión</h3>
    <div class="conversion-grid">
        <div class="conversion-card">
            <h4>Polar <span class="arrow">→</span> Rectangular</h4>
            <p>Conocemos \((r, \theta)\), buscamos \((a, b)\):</p>
            <div class="conv-formulas">
                <div class="conv-row">$$ a = r \cdot \cos(\theta) $$</div>
                <div class="conv-row">$$ b = r \cdot \sin(\theta) $$</div>
            </div>
        </div>

        <div class="conversion-card">
            <h4>Rectangular <span class="arrow">→</span> Polar</h4>
            <p>Conocemos \((a, b)\), buscamos \((r, \theta)\):</p>
            <div class="conv-formulas">
                <div class="conv-row">$$ r = \sqrt{a^2 + b^2} $$</div>
                <div class="conv-row">$$ \theta = \arctan(b/a) $$</div>
            </div>
        </div>
    </div>
</section>

            <section id="s1-5" class="content-section">
    <h2>5. Super Calculadora Gráfica</h2>
    <p>Realiza operaciones y visualiza los vectores en el plano complejo en tiempo real.</p>

    <div class="calculator-container">
        <div class="complex-input-group main-input">
            <div class="input-label">Número Complejo \(z_1\) <span class="dot-indicator" style="background:#0a84ff;"></span></div>
            <div class="input-wrapper">
                <input type="number" id="z1-real" placeholder="a" value="3">
                <span class="plus-sign">+</span>
                <input type="number" id="z1-imag" placeholder="b" value="2">
                <span class="i-symbol">i</span>
            </div>
            <div class="mini-actions">
                <button class="mini-btn" onclick="calcUnary('mod')">|z|</button>
                <button class="mini-btn" onclick="calcUnary('arg')">Arg(z)</button>
                <button class="mini-btn" onclick="calcUnary('conj')">Conj(\(\bar{z}\))</button>
            </div>
        </div>

        <div class="calc-actions">
            <button class="calc-btn op-btn" onclick="calcBinary('add')">Sumar (+)</button>
            <button class="calc-btn op-btn" onclick="calcBinary('sub')">Restar (-)</button>
            <button class="calc-btn op-btn" onclick="calcBinary('mul')">Multiplicar (×)</button>
            <button class="calc-btn op-btn" onclick="calcBinary('div')">Dividir (÷)</button>
        </div>

        <div class="complex-input-group secondary-input">
            <div class="input-label">Número Complejo \(z_2\) <span class="dot-indicator" style="background:#ff1493;"></span></div>
            <div class="input-wrapper">
                <input type="number" id="z2-real" placeholder="c" value="1">
                <span class="plus-sign">+</span>
                <input type="number" id="z2-imag" placeholder="d" value="-4">
                <span class="i-symbol">i</span>
            </div>
        </div>

        <div class="divider-line"></div>

        <div class="complex-input-group power-group">
            <div class="input-label">Potencia (\(z_1^n\))</div>
            <div class="power-wrapper">
                <span>Elevar \(z_1\) a la: </span>
                <input type="number" id="power-n" value="3" min="0" step="1">
                <button class="calc-btn power-btn" onclick="calcPower()">Calcular</button>
            </div>
        </div>
    </div>

    <div id="calc-result-area" class="result-box" style="display:none;">
        
        <div class="results-layout">
            <div class="data-column">
                <h3>Resultados:</h3>
                <div class="results-summary">
                    <div class="res-card">
                        <span class="res-label">Rectangular</span>
                        <span id="final-rect" class="res-val"></span>
                    </div>
                    <div class="res-card">
                        <span class="res-label">Polar</span>
                        <span id="final-polar" class="res-val"></span>
                    </div>
                </div>
                <h3>Procedimiento:</h3>
                <div id="step-by-step-content" class="math-steps"></div>
            </div>

            <div class="graph-column">
                <h3>Plano Complejo <span class="dot-indicator" style="background:#00ff00; margin-left:10px;"></span> Resultado</h3>
                <div class="canvas-wrapper">
                    <canvas id="complexCanvas" width="350" height="350"></canvas>
                </div>
                <p class="graph-note">* El gráfico se auto-escala para ajustar los vectores.</p>
            </div>
        </div>
    </div>
</section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // NAVEGACIÓN
            const navLinks = document.querySelectorAll('.sidebar-nav a');
            const contentSections = document.querySelectorAll('.content-section');

            function showSection(targetId) {
                const targetIdWithoutHash = targetId.substring(1);
                contentSections.forEach(section => section.classList.remove('active'));
                const sectionToShow = document.getElementById(targetIdWithoutHash);
                if(sectionToShow) sectionToShow.classList.add('active');
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === targetId) link.classList.add('active');
                });
            }
            
            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    showSection(link.getAttribute('href'));
                });
            });

            // Mostrar primera sección por defecto
            if(navLinks.length > 0) showSection(navLinks[0].getAttribute('href'));
            
            // BOTÓN COPIAR
            const copyButtons = document.querySelectorAll('.copy-btn');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const pre = button.nextElementSibling;
                    const code = pre.querySelector('code');
                    navigator.clipboard.writeText(code.innerText).then(() => {
                        const originalText = button.innerText;
                        button.innerText = 'Copiado!';
                        setTimeout(() => { button.innerText = originalText; }, 2000);
                    });
                });
            });

            // QUIZ LÓGICA
            const quizContainer = document.getElementById('quiz-container');
            if (quizContainer) {
                const questions = quizContainer.querySelectorAll('.quiz-card');
                const resultsContainer = document.getElementById('quiz-results-container');
                const scoreElement = document.getElementById('quiz-score');
                const resetButton = document.getElementById('quiz-reset-btn');
                let score = 0;
                let questionsAnswered = 0;

                questions.forEach(question => {
                    const options = question.querySelectorAll('.quiz-option');
                    options.forEach(option => {
                        option.addEventListener('click', () => {
                            const parentOptions = option.parentElement;
                            if (parentOptions.classList.contains('disabled')) return;

                            parentOptions.classList.add('disabled');
                            questionsAnswered++;
                            
                            const isCorrect = option.dataset.correct === 'true';
                            const feedback = question.querySelector('.quiz-feedback');

                            if (isCorrect) {
                                score++;
                                option.classList.add('correct');
                                feedback.textContent = '¡Correcto!';
                                feedback.className = 'quiz-feedback correct';
                            } else {
                                option.classList.add('incorrect');
                                feedback.textContent = 'Incorrecto.';
                                feedback.className = 'quiz-feedback incorrect';
                                const correctOption = parentOptions.querySelector('[data-correct="true"]');
                                if(correctOption) correctOption.classList.add('correct');
                            }
                            
                            if (questionsAnswered === questions.length) {
                                scoreElement.textContent = `Puntuación: ${score} / ${questions.length}`;
                                resultsContainer.style.display = 'block';
                            }
                        });
                    });
                });
                
                resetButton.addEventListener('click', () => {
                    score = 0;
                    questionsAnswered = 0;
                    resultsContainer.style.display = 'none';
                    questions.forEach(question => {
                        const optionsContainer = question.querySelector('.quiz-options');
                        optionsContainer.classList.remove('disabled');
                        
                        const options = question.querySelectorAll('.quiz-option');
                        options.forEach(opt => {
                            opt.classList.remove('correct', 'incorrect');
                        });

                        const feedback = question.querySelector('.quiz-feedback');
                        feedback.textContent = '';
                    });
                });
            }
        });

        // --- LÓGICA CALCULADORA + MOTOR GRÁFICO ---

// Funciones Auxiliares
const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
const fmt = (n) => (n >= 0 ? `+ ${Number(n.toFixed(4))}` : `- ${Math.abs(Number(n.toFixed(4)))}`);
const fmtN = (n) => Number(n.toFixed(4));

// --- MOTOR GRÁFICO ---
function drawGraph(z1, z2, zRes) {
    const canvas = document.getElementById('complexCanvas');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;
    
    // 1. Limpiar canvas
    ctx.clearRect(0, 0, width, height);
    
    // 2. Determinar Escala (Zoom automático)
    // Buscamos el valor más grande (absoluto) entre todos los puntos para que quepan
    let maxVal = 0;
    const points = [z1, zRes];
    if(z2) points.push(z2);
    
    points.forEach(p => {
        maxVal = Math.max(maxVal, Math.abs(p.r), Math.abs(p.i));
    });
    
    // Un poco de margen extra (1.2x)
    const limit = Math.max(5, maxVal * 1.2); 
    const scale = (width / 2) / limit; // Píxeles por unidad
    
    // Función para convertir coord matemática a coord canvas
    const toX = (x) => (width / 2) + (x * scale);
    const toY = (y) => (height / 2) - (y * scale); // Y invertido en canvas

    // 3. Dibujar Rejilla y Ejes
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 1;
    
    // Ejes principales
    ctx.beginPath();
    ctx.moveTo(0, height/2); ctx.lineTo(width, height/2); // Eje X
    ctx.moveTo(width/2, 0); ctx.lineTo(width/2, height); // Eje Y
    ctx.strokeStyle = '#888';
    ctx.stroke();

    // 4. Función para dibujar vectores (flechas)
    const drawVector = (r, i, color, label) => {
        if(r === 0 && i === 0) return;
        
        const x = toX(r);
        const y = toY(i);
        const originX = width/2;
        const originY = height/2;

        ctx.beginPath();
        ctx.moveTo(originX, originY);
        ctx.lineTo(x, y);
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;
        ctx.stroke();

        // Punta de flecha
        const angle = Math.atan2(y - originY, x - originX);
        const headLen = 10;
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.lineTo(x - headLen * Math.cos(angle - Math.PI / 6), y - headLen * Math.sin(angle - Math.PI / 6));
        ctx.lineTo(x - headLen * Math.cos(angle + Math.PI / 6), y - headLen * Math.sin(angle + Math.PI / 6));
        ctx.fillStyle = color;
        ctx.fill();

        // Etiqueta
        ctx.fillStyle = '#fff';
        ctx.font = '12px Arial';
        ctx.fillText(label, x + 5, y - 5);
    };

    // 5. Dibujar los vectores
    // Z1 (Azul)
    drawVector(z1.r, z1.i, '#0a84ff', 'Z1');
    
    // Z2 (Rosa) - Solo si existe
    if(z2 && (z2.r !== 0 || z2.i !== 0)) {
        drawVector(z2.r, z2.i, '#ff1493', 'Z2');
    }
    
    // Resultado (Verde Neón) - Se dibuja al final para quedar encima
    drawVector(zRes.r, zRes.i, '#00ff00', 'Res');
}

// --- LÓGICA DE CÁLCULO ---

const showResults = (real, imag, steps, z1Input, z2Input) => {
    document.getElementById('calc-result-area').style.display = 'block';
    
    // Render Steps
    const stepsNode = document.getElementById('step-by-step-content');
    stepsNode.innerHTML = steps;
    
    // Render Results
    document.getElementById('final-rect').innerHTML = `$$ ${fmtN(real)} ${fmt(imag)}i $$`;
    
    const r = Math.sqrt(real*real + imag*imag);
    const thDeg = Math.atan2(imag, real) * (180/Math.PI);
    document.getElementById('final-polar').innerHTML = `$$ ${fmtN(r)} \\angle ${fmtN(thDeg)}^\\circ $$`;

    if (window.MathJax) {
        MathJax.typesetPromise([stepsNode, document.querySelector('.results-summary')]).catch(e => console.log(e));
    }

    // Dibujar Gráfico
    drawGraph(z1Input, z2Input, {r: real, i: imag});
};

function calcBinary(op) {
    const z1 = { r: getVal('z1-real'), i: getVal('z1-imag') };
    const z2 = { r: getVal('z2-real'), i: getVal('z2-imag') };
    let fr = 0, fi = 0, steps = "";

    if (op === 'add') {
        fr = z1.r + z2.r; fi = z1.i + z2.i;
        steps = `$$ z_1 + z_2 = (${z1.r} + ${z2.r}) + (${z1.i} + ${z2.i})i = ${fmtN(fr)} ${fmt(fi)}i $$`;
    } 
    else if (op === 'sub') {
        fr = z1.r - z2.r; fi = z1.i - z2.i;
        steps = `$$ z_1 - z_2 = (${z1.r} - ${z2.r}) + (${z1.i} - ${z2.i})i = ${fmtN(fr)} ${fmt(fi)}i $$`;
    }
    else if (op === 'mul') {
        fr = (z1.r * z2.r) - (z1.i * z2.i); fi = (z1.r * z2.i) + (z2.r * z1.i);
        steps = `$$ z_1 \\cdot z_2 = ${fmtN(fr)} ${fmt(fi)}i $$ (Ver detalle arriba)`; // Simplificado para demo
    }
    else if (op === 'div') {
        const d = z2.r*z2.r + z2.i*z2.i;
        if(d===0) return alert("División por cero");
        fr = ((z1.r*z2.r)+(z1.i*z2.i))/d; fi = ((z1.i*z2.r)-(z1.r*z2.i))/d;
        steps = `$$ \\frac{z_1}{z_2} = ${fmtN(fr)} ${fmt(fi)}i $$`;
    }
    
    showResults(fr, fi, steps, z1, z2);
}

function calcUnary(op) {
    const z1 = { r: getVal('z1-real'), i: getVal('z1-imag') };
    let fr = 0, fi = 0, steps = "";
    
    if (op === 'mod') {
        const m = Math.sqrt(z1.r*z1.r + z1.i*z1.i);
        // Hack para graficar el módulo como un vector sobre el eje X
        showResults(m, 0, `$$ |z| = ${fmtN(m)} $$`, z1, null);
    } else if (op === 'conj') {
        fr = z1.r; fi = -z1.i;
        showResults(fr, fi, `$$ \\bar{z} = ${fr} ${fmt(fi)}i $$`, z1, null);
    } else if (op === 'arg') {
        // Solo graficamos z1
        showResults(z1.r, z1.i, `$$ \\text{Ver ángulo en Polar} $$`, z1, null);
    }
}

function calcPower() {
    const z1 = { r: getVal('z1-real'), i: getVal('z1-imag') };
    const n = parseFloat(document.getElementById('power-n').value);
    
    const m = Math.sqrt(z1.r*z1.r + z1.i*z1.i);
    const a = Math.atan2(z1.i, z1.r);
    
    const mNew = Math.pow(m, n);
    const aNew = a * n;
    
    const fr = mNew * Math.cos(aNew);
    const fi = mNew * Math.sin(aNew);
    
    showResults(fr, fi, `$$ z^${n} = ${fmtN(fr)} ${fmt(fi)}i $$`, z1, null);
}
    </script>
</body>
</html>